<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML to Markdown Converter - –§—ñ–Ω–∞–ª—å–Ω–∞ –≤–µ—Ä—Å—ñ—è</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
            max-width: 1000px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 40px;
            font-size: 1.1rem;
        }

        .input-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.4rem;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        textarea {
            width: 100%;
            min-height: 200px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-warning {
            background: #ffc107;
            color: #000;
        }

        .btn-danger {
            background: #dc3545;
        }

        .result-section {
            margin-top: 30px;
            display: none;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .result-stats {
            display: flex;
            gap: 20px;
            font-size: 0.9rem;
            color: #666;
        }

        .result-textarea {
            width: 100%;
            height: 400px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            overflow-y: auto;
            resize: vertical;
            display: block;
            box-sizing: border-box;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .result-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #28a745;
            display: none;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #dc3545;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            h1 {
                font-size: 2rem;
            }

            .buttons {
                justify-content: center;
            }

            .result-header {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>HTML ‚Üí Markdown</h1>
        <p class="subtitle">–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º–∏ —Ç–∞–±–ª–∏—Ü—è–º–∏ —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º</p>

        <!-- –í–≤–µ–¥–µ–Ω–Ω—è HTML -->
        <div class="input-section">
            <div class="section-title">
                <span>üìù</span> –í—Å—Ç–∞–≤—Ç–µ HTML –∫–æ–¥
            </div>
            <textarea id="html-input" placeholder="–í—Å—Ç–∞–≤—Ç–µ HTML –∫–æ–¥ –≤–µ–±-—Å—Ç–æ—Ä—ñ–Ω–∫–∏ —Å—é–¥–∏...

–Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è:
1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –ø–æ—Ç—Ä—ñ–±–Ω—É –≤–µ–±-—Å—Ç–æ—Ä—ñ–Ω–∫—É
2. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å Ctrl+U (–∞–±–æ Cmd+Option+U –Ω–∞ Mac)
3. –°–∫–æ–ø—ñ—é–π—Ç–µ –≤–µ—Å—å HTML –∫–æ–¥ (Ctrl+A, –ø–æ—Ç—ñ–º Ctrl+C)
4. –í—Å—Ç–∞–≤—Ç–µ –∫–æ–¥ —Å—é–¥–∏ —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å '–ö–æ–Ω–≤–µ—Ä—Ç—É–≤–∞—Ç–∏'"></textarea>
            
            <div class="buttons">
                <button class="btn" onclick="convertHTML()">
                    <span>üîÑ</span> –ö–æ–Ω–≤–µ—Ä—Ç—É–≤–∞—Ç–∏ –≤ Markdown
                </button>
                <button class="btn btn-secondary" onclick="loadExample()">
                    <span>üìÑ</span> –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø—Ä–∏–∫–ª–∞–¥
                </button>
                <button class="btn btn-secondary" onclick="clearHTML()">
                    <span>üóëÔ∏è</span> –û—á–∏—Å—Ç–∏—Ç–∏
                </button>
                <button class="btn btn-warning" onclick="copyDiagnostics()">
                    <span>üìã</span> –ö–æ–ø—ñ—é–≤–∞—Ç–∏ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫—É
                </button>
            </div>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
        <div id="result-section" class="result-section">
            <div class="result-header">
                <div class="section-title">
                    <span>‚úÖ</span> –†–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó
                </div>
                <div class="result-stats">
                    <span id="char-count">0 —Å–∏–º–≤–æ–ª—ñ–≤</span>
                    <span id="word-count">0 —Å–ª—ñ–≤</span>
                    <span id="line-count">0 —Ä—è–¥–∫—ñ–≤</span>
                </div>
            </div>

            <textarea id="markdown-output" readonly class="result-textarea" placeholder="–¢—É—Ç –∑'—è–≤–∏—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó..."></textarea>
            
            <div class="buttons">
                <button class="btn btn-success" onclick="copyResult()">
                    <span>üìã</span> –ö–æ–ø—ñ—é–≤–∞—Ç–∏ Markdown
                </button>
                <button class="btn btn-success" onclick="downloadResult()">
                    <span>üíæ</span> –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª
                </button>
                <button class="btn btn-danger" onclick="toggleResultSize()">
                    <span>üìè</span> <span id="toggle-text">–ó–±—ñ–ª—å—à–∏—Ç–∏</span>
                </button>
            </div>
        </div>

        <!-- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è -->
        <div id="message" class="hidden"></div>
    </div>

    <script>
        let currentMarkdown = '';
        let diagnosticsLog = [];
        let isResultExpanded = false;

        // –°–∏—Å—Ç–µ–º–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
        function logDiagnostic(message) {
            console.log(message);
            diagnosticsLog.push(`${new Date().toLocaleTimeString()}: ${message}`);
        }
        
        function clearDiagnostics() {
            diagnosticsLog = [];
        }
        
        function copyDiagnostics() {
            if (diagnosticsLog.length === 0) {
                alert('‚ùå –ù–µ–º–∞—î –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö. –°–ø–æ—á–∞—Ç–∫—É –∑–∞–ø—É—Å—Ç—ñ—Ç—å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—é.');
                return;
            }
            
            const diagnosticsText = `=== –î–Ü–ê–ì–ù–û–°–¢–ò–ö–ê HTML TO MARKDOWN ===
${diagnosticsLog.join('\n')}

=== –ö–Ü–ù–ï–¶–¨ –î–Ü–ê–ì–ù–û–°–¢–ò–ö–ò ===
–í—Å—å–æ–≥–æ –∑–∞–ø–∏—Å—ñ–≤: ${diagnosticsLog.length}
–ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ: ${new Date().toLocaleString()}`;

            navigator.clipboard.writeText(diagnosticsText).then(() => {
                showMessage('‚úÖ –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫—É —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º—ñ–Ω—É!', 'success');
            }).catch(() => {
                const textarea = document.createElement('textarea');
                textarea.value = diagnosticsText;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showMessage('‚úÖ –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫—É —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!', 'success');
            });
        }

        // –û—á–∏—â–µ–Ω–Ω—è HTML –≤—ñ–¥ —Ç–µ—Ö–Ω—ñ—á–Ω–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
        function cleanHTML(doc) {
            logDiagnostic('üßπ –ü–æ—á–∏–Ω–∞—î–º–æ –æ—á–∏—â–µ–Ω–Ω—è HTML...');
            
            // –°–ø–∏—Å–æ–∫ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è
            const elementsToRemove = [
                'style',     // CSS —Å—Ç–∏–ª—ñ
                'script',    // JavaScript –∫–æ–¥
                'link',      // –ó–æ–≤–Ω—ñ—à–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏ (CSS, —ñ–∫–æ–Ω–∫–∏)
                'meta',      // –ú–µ—Ç–∞-—Ç–µ–≥–∏
                'noscript',  // Noscript –±–ª–æ–∫–∏
                'iframe',    // –í–±—É–¥–æ–≤–∞–Ω—ñ —Ñ—Ä–µ–π–º–∏
                'object',    // –û–±'—î–∫—Ç–∏ Flash —Ç–æ—â–æ
                'embed',     // –í–±—É–¥–æ–≤–∞–Ω—ñ –º–µ–¥—ñ–∞
                'audio',     // –ê—É–¥—ñ–æ (–∑–∞–ª–∏—à–∞—î–º–æ —Ç—ñ–ª—å–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏)
                'video',     // –í—ñ–¥–µ–æ (–∑–∞–ª–∏—à–∞—î–º–æ —Ç—ñ–ª—å–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏)
                'canvas',    // Canvas –µ–ª–µ–º–µ–Ω—Ç–∏
                'svg',       // SVG –≥—Ä–∞—Ñ—ñ–∫–∞ (–º–æ–∂–µ –º—ñ—Å—Ç–∏—Ç–∏ –±–∞–≥–∞—Ç–æ –∫–æ–¥—É)
                'head'       // –í–µ—Å—å head –±–ª–æ–∫
            ];
            
            let removedCount = 0;
            
            // –í–∏–¥–∞–ª—è—î–º–æ –≤—Å—ñ —Ç–µ—Ö–Ω—ñ—á–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏
            elementsToRemove.forEach(tagName => {
                const elements = doc.querySelectorAll(tagName);
                elements.forEach(element => {
                    element.remove();
                    removedCount++;
                });
            });
            
            logDiagnostic(`üóëÔ∏è –í–∏–¥–∞–ª–µ–Ω–æ ${removedCount} —Ç–µ—Ö–Ω—ñ—á–Ω–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤`);
            
            // –û—á–∏—â–∞—î–º–æ –∞—Ç—Ä–∏–±—É—Ç–∏ —Å—Ç–∏–ª—ñ–≤ —Ç–∞ –ø–æ–¥—ñ–π
            const allElements = doc.querySelectorAll('*');
            let cleanedAttributes = 0;
            
            allElements.forEach(element => {
                // –°–ø–∏—Å–æ–∫ –∞—Ç—Ä–∏–±—É—Ç—ñ–≤ –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è
                const attributesToRemove = [
                    'style',      // –Ü–Ω–ª–∞–π–Ω —Å—Ç–∏–ª—ñ
                    'class',      // CSS –∫–ª–∞—Å–∏
                    'id',         // ID (–º–æ–∂—É—Ç—å –±—É—Ç–∏ —Ç–µ—Ö–Ω—ñ—á–Ω–∏–º–∏)
                    'onclick',    // JavaScript –ø–æ–¥—ñ—ó
                    'onload',
                    'onmouseover',
                    'onmouseout',
                    'onfocus',
                    'onblur',
                    'onchange',
                    'onsubmit',
                    'data-*'      // Data –∞—Ç—Ä–∏–±—É—Ç–∏
                ];
                
                // –í–∏–¥–∞–ª—è—î–º–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –∞—Ç—Ä–∏–±—É—Ç–∏
                attributesToRemove.forEach(attr => {
                    if (attr === 'data-*') {
                        // –í–∏–¥–∞–ª—è—î–º–æ –≤—Å—ñ data-* –∞—Ç—Ä–∏–±—É—Ç–∏
                        const attributes = Array.from(element.attributes);
                        attributes.forEach(attribute => {
                            if (attribute.name.startsWith('data-')) {
                                element.removeAttribute(attribute.name);
                                cleanedAttributes++;
                            }
                        });
                    } else if (element.hasAttribute(attr)) {
                        element.removeAttribute(attr);
                        cleanedAttributes++;
                    }
                });
            });
            
            logDiagnostic(`üßΩ –û—á–∏—â–µ–Ω–æ ${cleanedAttributes} –∞—Ç—Ä–∏–±—É—Ç—ñ–≤`);
            
            // –í–∏–¥–∞–ª—è—î–º–æ –ø–æ—Ä–æ–∂–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ (–∫—Ä—ñ–º br, hr, img)
            const allElementsAfterClean = doc.querySelectorAll('*');
            let removedEmptyElements = 0;
            
            allElementsAfterClean.forEach(element => {
                const tagName = element.tagName.toLowerCase();
                const allowedEmptyElements = ['br', 'hr', 'img', 'input', 'area', 'base', 'col', 'embed', 'source', 'track', 'wbr'];
                
                if (!allowedEmptyElements.includes(tagName) && 
                    !element.textContent.trim() && 
                    element.children.length === 0) {
                    element.remove();
                    removedEmptyElements++;
                }
            });
            
            logDiagnostic(`üóëÔ∏è –í–∏–¥–∞–ª–µ–Ω–æ ${removedEmptyElements} –ø–æ—Ä–æ–∂–Ω—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤`);
            logDiagnostic('‚úÖ –û—á–∏—â–µ–Ω–Ω—è HTML –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
            
            return doc;
        }

        // –û—Å–Ω–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó HTML
        function convertHTML() {
            clearDiagnostics();
            
            const htmlContent = document.getElementById('html-input').value.trim();
            
            logDiagnostic('üîç convertHTML –ü–û–ß–ê–¢–û–ö');
            logDiagnostic(`üìè –†–æ–∑–º—ñ—Ä –≤—Ö—ñ–¥–Ω–æ–≥–æ HTML: ${htmlContent.length} —Å–∏–º–≤–æ–ª—ñ–≤`);
            
            if (!htmlContent) {
                showMessage('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤—Å—Ç–∞–≤—Ç–µ HTML –∫–æ–¥', 'error');
                return;
            }

            try {
                const parser = new DOMParser();
                let doc = parser.parseFromString(htmlContent, 'text/html');
                
                logDiagnostic('üîÑ HTML —É—Å–ø—ñ—à–Ω–æ —Å–ø–∞—Ä—Å–µ–Ω–æ');
                logDiagnostic(`üìä DOM —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –î–û –æ—á–∏—â–µ–Ω–Ω—è: Body —Ç–µ–∫—Å—Ç = ${doc.body ? doc.body.textContent.length : 0} —Å–∏–º–≤–æ–ª—ñ–≤`);
                
                if (!doc || !doc.body) {
                    throw new Error('–ù–µ –≤–¥–∞–ª–æ—Å—è —Ä–æ–∑–ø–∞—Ä—Å–∏—Ç–∏ HTML');
                }
                
                // –û–ß–ò–©–ê–Ñ–ú–û HTML –≤—ñ–¥ —Ç–µ—Ö–Ω—ñ—á–Ω–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
                doc = cleanHTML(doc);
                
                logDiagnostic(`üìä DOM —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ü–Ü–°–õ–Ø –æ—á–∏—â–µ–Ω–Ω—è: Body —Ç–µ–∫—Å—Ç = ${doc.body ? doc.body.textContent.length : 0} —Å–∏–º–≤–æ–ª—ñ–≤`);
                
                logDiagnostic('üöÄ –ü–µ—Ä–µ–¥–∞—î–º–æ –≤ htmlToMarkdown...');
                const markdown = htmlToMarkdown(doc);
                
                if (!markdown || markdown.trim().length === 0) {
                    throw new Error('–†–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó –ø–æ—Ä–æ–∂–Ω—ñ–π');
                }
                
                logDiagnostic(`‚úÖ convertHTML –ó–ê–í–ï–†–®–ï–ù–û, —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${markdown.length} —Å–∏–º–≤–æ–ª—ñ–≤`);
                showResult(markdown);
                
            } catch (error) {
                logDiagnostic(`‚ùå –ü–æ–º–∏–ª–∫–∞ convertHTML: ${error.message}`);
                showMessage('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ–±—Ä–æ–±—Ü—ñ HTML: ' + error.message, 'error');
            }
        }

        // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è HTML –≤ Markdown
        function htmlToMarkdown(doc) {
            logDiagnostic('üîç htmlToMarkdown –ü–û–ß–ê–¢–û–ö');
            let markdown = '';

            // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –Ω–∞–π–±—ñ–ª—å—à–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç
            let contentElement = findBestContent(doc);
            
            if (!contentElement) {
                logDiagnostic('‚ùå –ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∂–æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É');
                return '';
            }

            logDiagnostic('üîÑ –ü–æ—á–∞—Ç–æ–∫ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó –µ–ª–µ–º–µ–Ω—Ç—ñ–≤...');
            const convertedContent = convertElement(contentElement);
            logDiagnostic(`üìè –ü—ñ—Å–ª—è convertElement, –¥–æ–≤–∂–∏–Ω–∞: ${convertedContent.length}`);
            
            markdown += convertedContent;
            
            const trimmedMarkdown = markdown.trim();
            logDiagnostic(`üèÅ htmlToMarkdown –ó–ê–í–ï–†–®–ï–ù–ù–Ø: ${trimmedMarkdown.length} —Å–∏–º–≤–æ–ª—ñ–≤`);

            return trimmedMarkdown;
        }

        // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –Ω–∞–π–∫—Ä–∞—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç (–ü–û–ß–ò–ù–ê–Æ–ß–ò –ó H1)
        function findBestContent(doc) {
            logDiagnostic('üîç –®—É–∫–∞—î–º–æ H1 –¥–ª—è –ø–æ—á–∞—Ç–∫—É –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó...');
            
            // –ö–†–û–ö 1: –ó–Ω–∞—Ö–æ–¥–∏–º–æ –ø–µ—Ä—à–∏–π H1
            const h1 = doc.querySelector('h1');
            if (!h1) {
                logDiagnostic('‚ùå H1 –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ fallback');
                return findFallbackContent(doc);
            }
            
            logDiagnostic(`‚úÖ –ó–Ω–∞–π–¥–µ–Ω–æ H1: "${h1.textContent.trim()}"`);
            
            // –ö–†–û–ö 2: –°—Ç–≤–æ—Ä—é—î–º–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç—É –ø–æ—á–∏–Ω–∞—é—á–∏ –∑ H1
            const container = document.createElement('div');
            
            // –ö–†–û–ö 3: –î–æ–¥–∞—î–º–æ H1 —è–∫ –ø–µ—Ä—à–∏–π –µ–ª–µ–º–µ–Ω—Ç
            container.appendChild(h1.cloneNode(true));
            
            // –ö–†–û–ö 4: –ó–Ω–∞—Ö–æ–¥–∏–º–æ –≤—Å—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –ü–Ü–°–õ–Ø H1
            let currentElement = h1;
            while (currentElement.nextElementSibling) {
                currentElement = currentElement.nextElementSibling;
                container.appendChild(currentElement.cloneNode(true));
                logDiagnostic(`‚ûï –î–æ–¥–∞–Ω–æ –µ–ª–µ–º–µ–Ω—Ç –ø—ñ—Å–ª—è H1: ${currentElement.tagName}`);
            }
            
            // –ö–†–û–ö 5: –Ø–∫—â–æ H1 –±—É–≤ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ, —à—É–∫–∞—î–º–æ –Ω–∞—Å—Ç—É–ø–Ω—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏ –Ω–∞ —Ç–æ–º—É –∂ —Ä—ñ–≤–Ω—ñ
            let parentContainer = h1.parentElement;
            if (parentContainer && parentContainer !== doc.body) {
                let nextContainer = parentContainer;
                while (nextContainer.nextElementSibling) {
                    nextContainer = nextContainer.nextElementSibling;
                    
                    // –î–æ–¥–∞—î–º–æ —Ç—ñ–ª—å–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏ –∑ –∫–æ—Ä–∏—Å–Ω–∏–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
                    if (nextContainer.textContent.trim().length > 50) {
                        container.appendChild(nextContainer.cloneNode(true));
                        logDiagnostic(`‚ûï –î–æ–¥–∞–Ω–æ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä: ${nextContainer.tagName}`);
                    }
                }
            }
            
            logDiagnostic(`‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ—á–∏–Ω–∞—é—á–∏ –∑ H1: ${container.textContent.length} —Å–∏–º–≤–æ–ª—ñ–≤`);
            return container;
        }

        // Fallback —è–∫—â–æ H1 –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ
        function findFallbackContent(doc) {
            const contentSelectors = [
                'article',
                'main', 
                '.content',
                '.post-content',
                '.entry-content',
                '#content'
            ];

            let contentElement = null;
            let maxTextLength = 0;
            
            for (const selector of contentSelectors) {
                const elements = doc.querySelectorAll(selector);
                elements.forEach(element => {
                    const textLength = element.textContent.trim().length;
                    logDiagnostic(`üîç Fallback –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ ${selector}: ${textLength} —Å–∏–º–≤–æ–ª—ñ–≤`);
                    
                    if (textLength > maxTextLength && textLength > 1000) {
                        maxTextLength = textLength;
                        contentElement = element;
                    }
                });
            }

            if (contentElement) {
                logDiagnostic(`‚úÖ Fallback –≤–∏–±—Ä–∞–Ω–æ: ${maxTextLength} —Å–∏–º–≤–æ–ª—ñ–≤`);
                return contentElement;
            }

            logDiagnostic('üîÑ –û—Å—Ç–∞–Ω–Ω—ñ–π fallback: –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ body');
            return doc.body;
        }

        // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
        function convertElement(element) {
            let markdown = '';
            let processedNodes = 0;
            
            logDiagnostic(`üîÑ convertElement: ${element.childNodes.length} –¥–æ—á—ñ—Ä–Ω—ñ—Ö –≤—É–∑–ª—ñ–≤`);
            
            for (let i = 0; i < element.childNodes.length; i++) {
                const child = element.childNodes[i];
                
                if (child.nodeType === Node.TEXT_NODE) {
                    const text = child.textContent.replace(/\s+/g, ' ').trim();
                    if (text) {
                        markdown += text + ' ';
                        processedNodes++;
                    }
                } else if (child.nodeType === Node.ELEMENT_NODE) {
                    const elementResult = convertHTMLElement(child);
                    markdown += elementResult;
                    if (elementResult) processedNodes++;
                }
            }

            logDiagnostic(`‚úÖ convertElement –∑–∞–≤–µ—Ä—à–µ–Ω–æ: ${processedNodes} –≤—É–∑–ª—ñ–≤, ${markdown.length} —Å–∏–º–≤–æ–ª—ñ–≤`);
            return markdown;
        }

        // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è HTML –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
        function convertHTMLElement(element) {
            const tagName = element.tagName.toLowerCase();
            const text = element.textContent.trim();
            
            if (!text && !['img', 'hr', 'br', 'table'].includes(tagName)) return '';

            switch (tagName) {
                case 'h1': return `\n# ${text}\n\n`;
                case 'h2': return `\n## ${text}\n\n`;
                case 'h3': return `\n### ${text}\n\n`;
                case 'h4': return `\n#### ${text}\n\n`;
                case 'h5': return `\n##### ${text}\n\n`;
                case 'h6': return `\n###### ${text}\n\n`;
                case 'p': 
                    return `\n${convertElement(element)}\n\n`;
                case 'strong':
                case 'b': 
                    return `**${text}**`;
                case 'em':
                case 'i': 
                    return `*${text}*`;
                case 'code': 
                    return `\`${text}\``;
                case 'pre': 
                    const codeElement = element.querySelector('code');
                    const codeText = codeElement ? codeElement.textContent : text;
                    return `\n\`\`\`\n${codeText}\n\`\`\`\n\n`;
                case 'a':
                    const href = element.getAttribute('href');
                    // –ü—Ä–æ–ø—É—Å–∫–∞—î–º–æ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
                    if (!href || 
                        href.startsWith('#') || 
                        href === '' || 
                        href.startsWith('javascript:') ||
                        href.includes('#')
                    ) {
                        return text;
                    }
                    return `[${text}](${href})`;
                case 'img':
                    const src = element.getAttribute('src');
                    const alt = element.getAttribute('alt') || '–∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è';
                    return src ? `![${alt}](${src})` : '';
                case 'ul':
                    return convertList(element, false);
                case 'ol':
                    return convertList(element, true);
                case 'li':
                    return convertElement(element);
                case 'blockquote':
                    return `\n> ${convertElement(element)}\n\n`;
                case 'table':
                    return convertTable(element);
                case 'br': 
                    return '\n';
                case 'hr': 
                    return '\n---\n\n';
                default: 
                    return convertElement(element);
            }
        }

        // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è —Å–ø–∏—Å–∫—ñ–≤
        function convertList(listElement, isOrdered) {
            let markdown = '\n';
            const items = listElement.querySelectorAll(':scope > li');
            
            items.forEach((item, index) => {
                const prefix = isOrdered ? `${index + 1}. ` : '- ';
                const content = convertElement(item).trim();
                markdown += `${prefix}${content}\n`;
            });
            
            return markdown + '\n';
        }

        // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è —Ç–∞–±–ª–∏—Ü—å
        function convertTable(table) {
            let markdown = '\n';
            const rows = table.querySelectorAll('tr');
            
            if (rows.length === 0) {
                logDiagnostic('‚ö†Ô∏è –¢–∞–±–ª–∏—Ü—è –±–µ–∑ —Ä—è–¥–∫—ñ–≤');
                return '';
            }
            
            logDiagnostic(`üìä –ö–æ–Ω–≤–µ—Ä—Ç—É—î–º–æ —Ç–∞–±–ª–∏—Ü—é: ${rows.length} —Ä—è–¥–∫—ñ–≤`);
            
            rows.forEach((row, rowIndex) => {
                const cells = row.querySelectorAll('td, th');
                if (cells.length === 0) return;
                
                // –°—Ç–≤–æ—Ä—é—î–º–æ —Ä—è–¥–æ–∫ —Ç–∞–±–ª–∏—Ü—ñ
                const cellContents = Array.from(cells).map(cell => {
                    let text = cell.textContent.trim();
                    text = text.replace(/\s+/g, ' '); // –û—á–∏—â–∞—î–º–æ –ø—Ä–æ–±—ñ–ª–∏
                    text = text.replace(/\|/g, '\\|'); // –ï–∫—Ä–∞–Ω—É—î–º–æ |
                    if (text.length > 50) { // –û–±—Ä—ñ–∑–∞—î–º–æ –¥–æ–≤–≥—ñ
                        text = text.substring(0, 47) + '...';
                    }
                    return text || ' ';
                });
                
                markdown += `| ${cellContents.join(' | ')} |\n`;
                
                // –î–æ–¥–∞—î–º–æ —Ä–æ–∑–¥—ñ–ª—å–Ω–∏–∫ –ø—ñ—Å–ª—è –ø–µ—Ä—à–æ–≥–æ —Ä—è–¥–∫—É
                if (rowIndex === 0) {
                    const separator = '|' + ' --- |'.repeat(cells.length) + '\n';
                    markdown += separator;
                    logDiagnostic(`üìã –î–æ–¥–∞–Ω–æ —Ä–æ–∑–¥—ñ–ª—å–Ω–∏–∫: ${cells.length} –∫–æ–ª–æ–Ω–æ–∫`);
                }
            });
            
            markdown += '\n';
            logDiagnostic(`‚úÖ –¢–∞–±–ª–∏—Ü—è –∫–æ–Ω–≤–µ—Ä—Ç–æ–≤–∞–Ω–∞ —É—Å–ø—ñ—à–Ω–æ`);
            
            return markdown;
        }

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–∏–∫–ª–∞–¥—É
        function loadExample() {
            const exampleHTML = `<!DOCTYPE html>
<html>
<head>
    <title>–ü—Ä–∏–∫–ª–∞–¥ —Å—Ç–∞—Ç—Ç—ñ –∑ —Ç–∞–±–ª–∏—Ü–µ—é</title>
</head>
<body>
    <article>
        <h1>–°—É—Ñ—ñ–∫—Å–∏ –≤ –∞–Ω–≥–ª—ñ–π—Å—å–∫—ñ–π –º–æ–≤—ñ</h1>
        
        <p>–°—É—Ñ—ñ–∫—Å–∏ –≤ –∞–Ω–≥–ª—ñ–π—Å—å–∫—ñ–π –º–æ–≤—ñ ‚Äî —Ü–µ —á–∞—Å—Ç–∏–Ω–∏ —Å–ª–æ–≤–∞, —è–∫—ñ –¥–æ–¥–∞—é—Ç—å—Å—è –¥–æ –æ—Å–Ω–æ–≤–∏ –¥–ª—è —É—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–∏—Ö —Å–ª—ñ–≤.</p>
        
        <h2>–û—Å–Ω–æ–≤–Ω—ñ —Ç–∏–ø–∏ —Å—É—Ñ—ñ–∫—Å—ñ–≤</h2>
        
        <h3>–°—É—Ñ—ñ–∫—Å–∏ —ñ–º–µ–Ω–Ω–∏–∫—ñ–≤</h3>
        <ul>
            <li>-tion (action)</li>
            <li>-ness (happiness)</li>
            <li>-ment (development)</li>
        </ul>
        
        <h3>–¢–∞–±–ª–∏—Ü—è –ø–æ–ø—É–ª—è—Ä–Ω–∏—Ö —Å—É—Ñ—ñ–∫—Å—ñ–≤</h3>
        <table>
            <tr>
                <th>–°—É—Ñ—ñ–∫—Å</th>
                <th>–ó–Ω–∞—á–µ–Ω–Ω—è</th>
                <th>–ü—Ä–∏–∫–ª–∞–¥</th>
                <th>–ü–µ—Ä–µ–∫–ª–∞–¥</th>
            </tr>
            <tr>
                <td>-able</td>
                <td>–∑–¥–∞—Ç–Ω—ñ—Å—Ç—å</td>
                <td>readable</td>
                <td>—á–∏—Ç–∞–±–µ–ª—å–Ω–∏–π</td>
            </tr>
            <tr>
                <td>-ful</td>
                <td>–ø–æ–≤–Ω–∏–π —á–æ–≥–æ—Å—å</td>
                <td>beautiful</td>
                <td>–∫—Ä–∞—Å–∏–≤–∏–π</td>
            </tr>
            <tr>
                <td>-less</td>
                <td>–±–µ–∑ —á–æ–≥–æ—Å—å</td>
                <td>homeless</td>
                <td>–±–µ–∑–¥–æ–º–Ω–∏–π</td>
            </tr>
            <tr>
                <td>-ly</td>
                <td>—Å–ø–æ—Å—ñ–± –¥—ñ—ó</td>
                <td>quickly</td>
                <td>—à–≤–∏–¥–∫–æ</td>
            </tr>
        </table>
        
        <h2>–í–∏—Å–Ω–æ–≤–æ–∫</h2>
        <p>–ó–Ω–∞–Ω–Ω—è —Å—É—Ñ—ñ–∫—Å—ñ–≤ –¥–æ–ø–æ–º–∞–≥–∞—î <strong>–∫—Ä–∞—â–µ —Ä–æ–∑—É–º—ñ—Ç–∏</strong> –∞–Ω–≥–ª—ñ–π—Å—å–∫—É –º–æ–≤—É —Ç–∞ <em>—Ä–æ–∑—à–∏—Ä—é–≤–∞—Ç–∏ —Å–ª–æ–≤–Ω–∏–∫–æ–≤–∏–π –∑–∞–ø–∞—Å</em>.</p>
        
        <blockquote>
            <p>–í–∏–≤—á–µ–Ω–Ω—è —Å—É—Ñ—ñ–∫—Å—ñ–≤ ‚Äî —Ü–µ –∫–ª—é—á –¥–æ —Ä–æ–∑—É–º—ñ–Ω–Ω—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –∞–Ω–≥–ª—ñ–π—Å—å–∫–∏—Ö —Å–ª—ñ–≤.</p>
        </blockquote>
    </article>
</body>
</html>`;
            
            document.getElementById('html-input').value = exampleHTML;
            showMessage('üìÑ –ü—Ä–∏–∫–ª–∞–¥ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ! –¢–µ–ø–µ—Ä –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ö–æ–Ω–≤–µ—Ä—Ç—É–≤–∞—Ç–∏"', 'success');
        }

        // –û—á–∏—â–µ–Ω–Ω—è
        function clearHTML() {
            document.getElementById('html-input').value = '';
            document.getElementById('result-section').style.display = 'none';
            currentMarkdown = '';
        }

        // –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
        function showResult(markdown) {
            currentMarkdown = markdown;
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            const charCount = markdown.length;
            const wordCount = markdown.trim().split(/\s+/).filter(word => word.length > 0).length;
            const lineCount = markdown.split('\n').length;
            
            document.getElementById('char-count').textContent = charCount.toLocaleString() + ' —Å–∏–º–≤–æ–ª—ñ–≤';
            document.getElementById('word-count').textContent = wordCount.toLocaleString() + ' —Å–ª—ñ–≤';
            document.getElementById('line-count').textContent = lineCount.toLocaleString() + ' —Ä—è–¥–∫—ñ–≤';
            
            // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
            const outputTextarea = document.getElementById('markdown-output');
            outputTextarea.value = markdown;
            
            document.getElementById('result-section').style.display = 'block';
            document.getElementById('result-section').scrollIntoView({ behavior: 'smooth' });
            
            logDiagnostic(`‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–æ: ${charCount} —Å–∏–º–≤–æ–ª—ñ–≤`);
        }

        // –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
        function copyResult() {
            if (!currentMarkdown) {
                showMessage('‚ùå –ù–µ–º–∞—î –∫–æ–Ω—Ç–µ–Ω—Ç—É –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è', 'error');
                return;
            }
            
            navigator.clipboard.writeText(currentMarkdown).then(() => {
                showMessage('‚úÖ Markdown —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º—ñ–Ω—É!', 'success');
            }).catch(() => {
                const textarea = document.createElement('textarea');
                textarea.value = currentMarkdown;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showMessage('‚úÖ Markdown —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!', 'success');
            });
        }

        // –°–¢–í–û–†–ï–ù–ù–Ø –§–ê–ô–õ–£ –∑ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é –≤–∏–±–æ—Ä—É –¥—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º
        function downloadResult() {
            if (!currentMarkdown || currentMarkdown.length === 0) {
                showMessage('‚ùå –ù–µ–º–∞—î –∫–æ–Ω—Ç–µ–Ω—Ç—É –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è. –°–ø–æ—á–∞—Ç–∫—É –∑–∫–æ–Ω–≤–µ—Ä—Ç—É–π—Ç–µ HTML.', 'error');
                return;
            }
            
            logDiagnostic('üíæ –°—Ç–≤–æ—Ä—é—î–º–æ —Ñ–∞–π–ª –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞...');
            
            // –ì–µ–Ω–µ—Ä—É—î–º–æ —ñ–º'—è —Ñ–∞–π–ª—É
            const now = new Date();
            const timestamp = now.getFullYear() + 
                             String(now.getMonth() + 1).padStart(2, '0') + 
                             String(now.getDate()).padStart(2, '0') + '_' +
                             String(now.getHours()).padStart(2, '0') + 
                             String(now.getMinutes()).padStart(2, '0');
            const fileName = `markdown_${timestamp}.md`;
            
            logDiagnostic(`üìù –Ü–º'—è —Ñ–∞–π–ª—É: ${fileName}`);
            
            // –°—Ç–≤–æ—Ä—é—î–º–æ —Ñ–∞–π–ª
            const blob = new Blob([currentMarkdown], {type: 'text/plain;charset=utf-8'});
            const fileUrl = URL.createObjectURL(blob);
            const fileSize = (blob.size / 1024).toFixed(1);
            
            logDiagnostic(`üì¶ –§–∞–π–ª —Å—Ç–≤–æ—Ä–µ–Ω–æ, —Ä–æ–∑–º—ñ—Ä: ${fileSize} KB`);
            
            // –ü–æ–∫–∞–∑—É—î–º–æ –¥—ñ–∞–ª–æ–≥ –∑ –æ–ø—Ü—ñ—è–º–∏
            showFileActionDialog(fileName, fileUrl, fileSize, blob);
        }
        
        // –Ñ–î–ò–ù–ò–ô –ù–ê–î–Ü–ô–ù–ò–ô –º–µ—Ç–æ–¥ - –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç—É
        function downloadResult() {
            if (!currentMarkdown || currentMarkdown.length === 0) {
                showMessage('‚ùå –ù–µ–º–∞—î –∫–æ–Ω—Ç–µ–Ω—Ç—É –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è. –°–ø–æ—á–∞—Ç–∫—É –∑–∫–æ–Ω–≤–µ—Ä—Ç—É–π—Ç–µ HTML.', 'error');
                return;
            }
            
            logDiagnostic('üíæ –ü–æ–∫–∞–∑—É—î–º–æ –Ω–∞–¥—ñ–π–Ω–∏–π –º–µ—Ç–æ–¥ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è...');
            
            // –ì–µ–Ω–µ—Ä—É—î–º–æ —ñ–º'—è —Ñ–∞–π–ª—É
            const now = new Date();
            const timestamp = now.getFullYear() + 
                             String(now.getMonth() + 1).padStart(2, '0') + 
                             String(now.getDate()).padStart(2, '0') + '_' +
                             String(now.getHours()).padStart(2, '0') + 
                             String(now.getMinutes()).padStart(2, '0');
            const fileName = `markdown_${timestamp}.md`;
            
            const fileSize = (currentMarkdown.length / 1024).toFixed(1);
            
            logDiagnostic(`üìù –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–µ —ñ–º'—è —Ñ–∞–π–ª—É: ${fileName}`);
            logDiagnostic(`üì¶ –†–æ–∑–º—ñ—Ä: ${fileSize} KB`);
            
            // –ü–æ–∫–∞–∑—É—î–º–æ –ø—Ä–æ—Å—Ç–∏–π –¥—ñ–∞–ª–æ–≥ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è
            showCopyDialog(fileName, fileSize);
        }
        
        // –ü—Ä–æ—Å—Ç–∏–π –¥—ñ–∞–ª–æ–≥ —Ç—ñ–ª—å–∫–∏ –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è
        function showCopyDialog(fileName, fileSize) {
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.9);
                z-index: 99999;
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(3px);
            `;
            
            const dialog = document.createElement('div');
            dialog.style.cssText = `
                background: white;
                padding: 30px;
                border-radius: 15px;
                max-width: 600px;
                box-shadow: 0 25px 50px rgba(0,0,0,0.4);
                border: 1px solid #e0e0e0;
                text-align: center;
            `;
            
            dialog.innerHTML = `
                <div style="margin-bottom: 25px;">
                    <div style="font-size: 48px; margin-bottom: 15px;">üìã</div>
                    <h3 style="margin: 0 0 10px 0; color: #333; font-size: 1.4rem;">–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É</h3>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <div style="font-weight: bold; color: #333; margin-bottom: 5px;">–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–µ —ñ–º'—è: ${fileName}</div>
                        <div style="color: #666; font-size: 0.9rem;">–†–æ–∑–º—ñ—Ä: ${fileSize} KB</div>
                    </div>
                </div>
                
                <div style="background: #e7f3ff; border: 1px solid #b3d9ff; border-radius: 8px; padding: 20px; margin: 20px 0;">
                    <h4 style="margin: 0 0 15px 0; color: #0066cc;">üìã –Ñ–¥–∏–Ω–∏–π –Ω–∞–¥—ñ–π–Ω–∏–π –º–µ—Ç–æ–¥</h4>
                    <p style="margin: 0 0 15px 0; color: #333; line-height: 1.6; text-align: left;">
                        <strong>–ö—Ä–æ–∫ 1:</strong> –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É "–ö–æ–ø—ñ—é–≤–∞—Ç–∏ —Ç–µ–∫—Å—Ç"<br>
                        <strong>–ö—Ä–æ–∫ 2:</strong> –í—ñ–¥–∫—Ä–∏–π—Ç–µ —Ç–µ–∫—Å—Ç–æ–≤–∏–π —Ä–µ–¥–∞–∫—Ç–æ—Ä (–ë–ª–æ–∫–Ω–æ—Ç, VS Code, Notepad++)<br>
                        <strong>–ö—Ä–æ–∫ 3:</strong> –í—Å—Ç–∞–≤—Ç–µ —Ç–µ–∫—Å—Ç (Ctrl+V)<br>
                        <strong>–ö—Ä–æ–∫ 4:</strong> –ó–±–µ—Ä–µ–∂—ñ—Ç—å —Ñ–∞–π–ª —è–∫ <strong>${fileName}</strong>
                    </p>
                    
                    <button id="copyTextBtn" style="
                        background: #28a745; 
                        color: white; 
                        border: none; 
                        padding: 15px 30px; 
                        border-radius: 8px; 
                        cursor: pointer; 
                        font-weight: bold;
                        font-size: 16px;
                        margin: 10px 0;
                        width: 100%;
                    ">
                        üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏ –≤–µ—Å—å —Ç–µ–∫—Å—Ç
                    </button>
                </div>
                
                <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; margin: 15px 0;">
                    <h4 style="margin: 0 0 10px 0; color: #856404;">üí° –ü–æ—Ä–∞–¥–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä—ñ–≤:</h4>
                    <div style="text-align: left; color: #856404; font-size: 0.9rem; line-height: 1.5;">
                        <strong>‚Ä¢ –ë–ª–æ–∫–Ω–æ—Ç (Windows):</strong> –§–∞–π–ª ‚Üí –ó–±–µ—Ä–µ–≥—Ç–∏ —è–∫ ‚Üí –¢–∏–ø: "–í—Å—ñ —Ñ–∞–π–ª–∏" ‚Üí –Ü–º'—è: ${fileName}<br>
                        <strong>‚Ä¢ VS Code:</strong> Ctrl+N ‚Üí Ctrl+V ‚Üí Ctrl+S ‚Üí –Ü–º'—è: ${fileName}<br>
                        <strong>‚Ä¢ Notepad++:</strong> Ctrl+N ‚Üí Ctrl+V ‚Üí Ctrl+S ‚Üí –Ü–º'—è: ${fileName}<br>
                        <strong>‚Ä¢ –û–Ω–ª–∞–π–Ω:</strong> <a href="https://dillinger.io" target="_blank" style="color: #0066cc;">dillinger.io</a> - –æ–Ω–ª–∞–π–Ω Markdown —Ä–µ–¥–∞–∫—Ç–æ—Ä
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <button id="closeBtn" style="
                        background: #dc3545; 
                        color: white; 
                        border: none; 
                        padding: 10px 20px; 
                        border-radius: 6px; 
                        cursor: pointer; 
                        font-size: 14px;
                    ">
                        ‚ùå –ó–∞–∫—Ä–∏—Ç–∏
                    </button>
                </div>
                
                <div style="margin-top: 15px; font-size: 0.8rem; color: #666;">
                    ‚ö†Ô∏è <strong>–í–∞–∂–ª–∏–≤–æ:</strong> –ó–±–µ—Ä–µ–∂—ñ—Ç—å —Ñ–∞–π–ª –∑ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è–º <strong>.md</strong> —â–æ–± –≤—ñ–Ω –≤—ñ–¥–∫—Ä–∏–≤–∞–≤—Å—è —è–∫ Markdown
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            // –û–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π
            document.getElementById('copyTextBtn').addEventListener('click', function() {
                navigator.clipboard.writeText(currentMarkdown).then(() => {
                    this.innerHTML = '‚úÖ –¢–µ–∫—Å—Ç —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!';
                    this.style.background = '#28a745';
                    logDiagnostic('üìã –¢–µ–∫—Å—Ç —É—Å–ø—ñ—à–Ω–æ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ');
                    
                    setTimeout(() => {
                        alert('‚úÖ –¢–µ–∫—Å—Ç —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º—ñ–Ω—É!\n\nüìù –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏:\n1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ —Ç–µ–∫—Å—Ç–æ–≤–∏–π —Ä–µ–¥–∞–∫—Ç–æ—Ä\n2. –í—Å—Ç–∞–≤—Ç–µ —Ç–µ–∫—Å—Ç (Ctrl+V)\n3. –ó–±–µ—Ä–µ–∂—ñ—Ç—å —è–∫ —Ñ–∞–π–ª .md\n\nüí° –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–µ —ñ–º\'—è: ' + fileName);
                    }, 500);
                }).catch(() => {
                    // Fallback –¥–ª—è —Å—Ç–∞—Ä–∏—Ö –±—Ä–∞—É–∑–µ—Ä—ñ–≤
                    try {
                        const textArea = document.createElement('textarea');
                        textArea.value = currentMarkdown;
                        textArea.style.position = 'fixed';
                        textArea.style.left = '-9999px';
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        
                        this.innerHTML = '‚úÖ –¢–µ–∫—Å—Ç —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!';
                        this.style.background = '#28a745';
                        logDiagnostic('üìã –¢–µ–∫—Å—Ç —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ fallback');
                        
                        setTimeout(() => {
                            alert('‚úÖ –¢–µ–∫—Å—Ç —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!\n\n–í—ñ–¥–∫—Ä–∏–π—Ç–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä —ñ –≤—Å—Ç–∞–≤—Ç–µ (Ctrl+V)');
                        }, 500);
                    } catch (fallbackError) {
                        alert('‚ùå –ü–æ–º–∏–ª–∫–∞ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è.\n\n–°–ø—Ä–æ–±—É–π—Ç–µ:\n1. –í–∏–¥—ñ–ª–∏—Ç–∏ —Ç–µ–∫—Å—Ç –≤ –ø–æ–ª—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É\n2. –ù–∞—Ç–∏—Å–Ω—É—Ç–∏ Ctrl+C\n3. –í—Å—Ç–∞–≤–∏—Ç–∏ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä');
                        logDiagnostic('‚ùå Fallback –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –Ω–µ –ø—Ä–∞—Ü—é—î: ' + fallbackError.message);
                    }
                });
            });
            
            document.getElementById('closeBtn').addEventListener('click', function() {
                document.body.removeChild(overlay);
                logDiagnostic('‚ùå –î—ñ–∞–ª–æ–≥ –∑–∞–∫—Ä–∏—Ç–æ');
            });
            
            // –ó–∞–∫—Ä–∏—Ç—Ç—è –ø–æ –∫–ª—ñ–∫—É –Ω–∞ —Ñ–æ–Ω
            overlay.addEventListener('click', function(e) {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                    logDiagnostic('‚ùå –î—ñ–∞–ª–æ–≥ –∑–∞–∫—Ä–∏—Ç–æ –∫–ª—ñ–∫–æ–º –ø–æ —Ñ–æ–Ω—É');
                }
            });
            
            logDiagnostic('üìã –ü–æ–∫–∞–∑–∞–Ω–æ –¥—ñ–∞–ª–æ–≥ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç—É');
            showMessage('üìã –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç—É –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è', 'success');
        }

        // –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è —Ä–æ–∑–º—ñ—Ä—É
        function toggleResultSize() {
            const textarea = document.getElementById('markdown-output');
            const toggleText = document.getElementById('toggle-text');
            
            if (isResultExpanded) {
                textarea.style.height = '400px';
                toggleText.textContent = '–ó–±—ñ–ª—å—à–∏—Ç–∏';
                isResultExpanded = false;
            } else {
                textarea.style.height = '700px';
                toggleText.textContent = '–ó–º–µ–Ω—à–∏—Ç–∏';
                isResultExpanded = true;
            }
        }

        // –ü–æ–∫–∞–∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = type === 'success' ? 'success-message' : 'error-message';
            messageDiv.style.display = 'block';
            
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>
